# Hotel

---

# 🚀 Запуск проекта

---

## 1. Склонируйте репозиторий:

Для этого выполните команду

```bash
git clone https://github.com/GitPika4y/Hotel_3
```

## 2. Укажите строку подключения

В представленном файле .env представлена строка для подключения к локальному серверу MSSQLServer,
с входом по аутентификации Windows (т.е. без пользователя и пароля)

Чтобы изменить строку подключения, укажите собственное значение переменной окружения DB_CONNECTION_STRING,
например: 

`DB_CONNECTION_STRING=Server=someserver;Database=My Database;User Id=some user;Password=password;Trusted_Connection=True;TrustServerCertificate=True;`

заменяя значения `someserver`, `some user`, `My Database`, `password` на свои

Удостоверьтесь что данная БД существует на сервере, и подключение стабильно.

При отсутствии таковой БД, на сервере появится новая, с тем именем, что было указано в строке подключения

## 3. Примените миграции

Если у вас `Visual Studio`, то выберите: `Средства -> Диспетчер пакетов NuGet -> Консоль диспетчера пакетов`.
Должна будет появится консоль с припиской `PM>`. 

В данной консоли выберите `Проект по умолчанию`: `Hotel_3.EntityFramework`

После чего выполните данную команду

```bash
update-database
```

[Если произошла ошибка](#ошибка-миграции)

Или если у вас `JetBrains Rider`, кликните правой кнопкой мыши на проект `Hotel_3.EntityFramework`,
и выберите `Entity Framework Core > Update-Database`

После успешно примененных миграций, в БД появятся новые таблицы:

`__EFMigrationsHistory`, `Bookings`, `Clients`, `Roles`, `RoomCategories`, `Rooms`, `RoomStatuses`, `Users`

Что будет означать что миграция выполнена успешно

## 4. Добавьте админа

Данный проект предполагает наличие хотя бы 1 пользователя (админа), для работы с приложением и управлением другими пользователями

Для этого зайдите в MSSQLServer и выполните следующее в вашей БД:

### Создайте роль

Для добавления роли, зайдите в созданную ранее таблицу `Roles`, и добавьте новую запись 
с пропуском `Id` (после создания сущности он вставится автоматически), и указав в `Name` значение `Админ`

Создав роль, запомните её `Id` (если всё получится с первого раза, то он будет равен `1`)

### Создайте пользователя

#### Вариант 1
Зайдите в таблицу `Users`, и добавьте новую запись, также пропуская Id,
и вставив в поле `RoleId` `Id` ранее добавленной роли.

#### Вариант 2
Впишите следующую команду в Sql запрос:

```bash
INSERT INTO Roles (Name) VALUES ('Админ');
INSERT INTO Users (Login, Password, RoleId) VALUES ('admin', 'password', 1);
```

## 5. Запустите приложение

Вам необходимо окрыть `решение проекта`.

Для этого откройте файл `Hotel_3.sln`

Если у вас его нет, и видны лишь 3 проекта: `Hotel_3.Domain`, `Hotel_3.EntityFramework`, `Hotel_3.WPF`.
Значит у вас уже запущено `решение проекта`.

После этого настройте чтобы запускался лишь 1 проект - `Hotel_3.WPF`

Для этого в `Visual Studio` раскройте кнопку запуска проекта, выберите `Настройка начальных проектов`
, укажите Один запускаемый проект - `Hotel_3.WPF` -> ок

Еще раз убедитесь что к серверу есть доступ.

Теперь ваше приложение готово к запуску.

## Решение ошибок

## Ошибка Миграции

При ошибке наподобии `Your startup project 'Hotel_3.WPF' doesn't reference Microsoft.EntityFrameworkCore.Design. This package is required for the Entity Framework Core Tools to work. Ensure your startup project is correct, install the package, and try again.`

В `Visual Studio` раскройте кнопку запуска проекта, выберите `Настройка начальных проектов`
, укажите Один запускаемый проект - `Hotel_3.EntityFramework` -> применить -> ок